#! /usr/bin/env bash


name=$1

# Normanisation de quelques caractères dérangeants
# TODO: il existe probablement un autre moyen plus efficace et plus général (ex. conversion vers ainsi ou remplacer tout les caractères qui ne sont pas des lettres ainsi)
ename="${name// /-}"
ename="${ename/,/-}"
ename="${ename/;/-}"
ename="${ename/!/-}"
ename="${ename/./-}"
ename="${ename/é/e}"
ename="${ename/ê/e}"
ename="${ename/è/e}"
ename="${ename/à/a}"
ename="${ename/ç/c}"
ename="${ename/ù/u}"
ename="${ename/\'/-}"
ename="${ename/\"/-}"

d=$(date +%Y-%m-%d)
filename=_posts/$d-$ename.md

if [ -f $filename ];then
  echo "file $filename exists"
	exit 1
fi

if [ "$(git rev-parse --verify $ename)" != "" ]; then
  echo "branch $ename already exists"
	exit 1
fi

git stash
git checkout gh-pages
git checkout -b $ename


iname="${name/-/ }"
iname="${iname/_/ }"

echo "---" >  $filename
echo "title: $iname" >> $filename
echo "layout: page" >> $filename
echo "---" >> $filename
